# capsule

プログラムを再起動すると変数などに保存されたデータは失われてしまいます。プログラムの停止や再起動に影響を受けずにデータを永続的に保存する方法として、データベースを使用することが一般的です。capsule パッケージは、さほど大きくないデータを JSON 形式でデータベースに登録し永続化するための各種関数を提供します。このパッケージが十全に機能するためには以下の環境変数が登録されている必要があります。

- NS_MARIADB_USER
- NS_MARIADB_PASSWORD
- NS_MARIADB_HOSTNAME
- NS_MARIADB_PORT
- NS_MARIADB_DATABASE

主な用途として NeoShowcase 上で運用する traQ Bot のためのデータ永続化を想定していますが、他にも何らかの理由で少量のデータを保っておきたい場合にこのパッケージを用いることができます。

## 主要関数

### SetUp

reset が true またはデータベースにまだ値が登録されていないとき、データベースに origin を登録して初期化します。

```go
func SetUp[T any](origin T, reset bool)
```

#### 引数

| 名称       | 型   | 説明                                                                                 |
| ---------- | ---- | ------------------------------------------------------------------------------------ |
| **origin** | any  | データベースに登録するデータの初期値。各要素に json タグを持つ構造体である必要がある |
| **reset**  | bool | データベースを常に初期化するか否か                                                   |

#### 返り値

なし。接続に失敗するとその場で panic します。

### Load

データベースからデータを読み込みます。ジェネリクスの型を指定してください。

```go
func Load[T any]() (T, error)
```

#### 引数

なし

#### 返り値

| 型    | 説明                                                                 |
| ----- | -------------------------------------------------------------------- |
| any   | データベースに登録されていたデータ                                   |
| error | データの読み込みに失敗したときのエラーメッセージ。成功した場合は nil |

### Save

データベースにデータを登録します。

```go
func Save[T any](config T) error
```

#### 引数

| 名称       | 型  | 説明                                                                         |
| ---------- | --- | ---------------------------------------------------------------------------- |
| **origin** | any | データベースに登録するデータ。各要素に json タグを持つ構造体である必要がある |

#### 返り値

| 型    | 説明                                                             |
| ----- | ---------------------------------------------------------------- |
| error | データの登録に失敗したときのエラーメッセージ。成功した場合は nil |

## その他の関数